---
title: "DB Network Assignment"
author: "Emmanuel Bungei"
date: "2025-11-29"
output: html_document
---
```{r}
library(readxl)
data <- read_excel("starwars-links.xlsx")
head(data)
```

```{r}
library(igraph)
g <- graph_from_data_frame(data, directed = FALSE)
E(g)$weight <- data$scenes
```

```{r}

betweenness_values <- betweenness(g, weights = 1/E(g)$weight)

colors.new <- rev(rainbow(10, end = 2/3))
net.betweenness <- floor((betweenness_values - min(betweenness_values))/diff(range(betweenness_values)) * (length(colors.new)-1) + 1)

V(g)$color <- colors.new[net.betweenness]

#margins
par(mar = c(1, 1, 3, 1))

plot(g,vertex.size = sqrt(betweenness_values) * 0.3,vertex.label.cex = 0.6,edge.width = E(g)$weight/10,main = "Character Interaction Plot",rescale = TRUE,asp = 0)

#legend
legend("bottomright",legend=c("High","Low"),fill=c(colors.new[10],colors.new[1]),title = "Betweenness",border = NA,bg = "white",box.col = "gray",cex = 0.7)
```

Step 4: Calculate Metrics

```{r}
# ============================================
# QUESTION 1: Most Central Characters
# ============================================

# Degree centrality
degree_cent <- degree(g)
#Top 10 characters by degree
print(sort(degree_cent, decreasing = TRUE)[1:10])

# Weighted degree (strength)
strength_cent <- strength(g, weights = E(g)$weight)
# Top 10 characters by weighted degree
print(sort(strength_cent, decreasing = TRUE)[1:10])
# Closeness centrality
closeness_cent <- closeness(g, weights = 1/E(g)$weight)
# Top 10 characters by closeness centrality
print(sort(closeness_cent, decreasing = TRUE)[1:10])

# Eigenvector centrality
eigen_cent <- eigen_centrality(g, weights = E(g)$weight)$vector
#Top 10 characters by eigenvector centrality
print(sort(eigen_cent, decreasing = TRUE)[1:10])

# ============================================
# QUESTION 2: Community Structure
# ============================================

#Q2:

# Louvain community detection
communities <- cluster_louvain(g, weights = E(g)$weight)

# Number of communities detected:
cat("Modularity score:", modularity(communities), "\n")
cat("\nCommunity sizes:\n")
print(sizes(communities))

cat("\nCharacters in each community:\n")
for(i in 1:length(communities)) {
  cat(sprintf("\nCommunity %d (%d members):\n", i, sum(membership(communities) == i)))
  print(V(g)$name[membership(communities) == i])
}

# ============================================
# QUESTION 3: Bridge Characters
# ============================================

#Q3

# Betweenness centrality
betweenness_cent <- betweenness(g, weights = 1/E(g)$weight)
# Top 10 characters by betweenness centrality
print(sort(betweenness_cent, decreasing = TRUE)[1:10])
# Edge betweenness
edge_between <- edge_betweenness(g, weights = 1/E(g)$weight)
# Top 10 most important connections (edge betweenness)
top_edges <- order(edge_between, decreasing = TRUE)[1:10]
for(i in top_edges) {
  cat(sprintf("Characters %s - %s: %.2f\n", 
              ends(g, i)[1], ends(g, i)[2], edge_between[i]))
}


# Summary statistics
cat("\n\n=== OVERALL NETWORK STATISTICS ===\n\n")
cat("Average degree:", mean(degree_cent), "\n")
cat("Network diameter:", diameter(g, weights = 1/E(g)$weight), "\n")
cat("Average path length:", mean_distance(g, weights = 1/E(g)$weight), "\n")
cat("Clustering coefficient:", transitivity(g, type = "global"), "\n")
cat("Network density:", edge_density(g), "\n")
```
